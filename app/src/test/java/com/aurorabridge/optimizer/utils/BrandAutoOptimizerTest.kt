package com.aurorabridge.optimizer.utils\n\nimport android.content.Context\nimport android.content.res.Resources\nimport android.os.Build\nimport com.aurorabridge.optimizer.R\nimport com.aurorabridge.optimizer.model.DeviceBrand\nimport org.json.JSONArray\nimport org.json.JSONObject\nimport org.junit.Assert.assertEquals\nimport org.junit.Before\nimport org.junit.Test\nimport org.junit.runner.RunWith\nimport org.mockito.Mock\nimport org.mockito.Mockito.`when`\nimport org.mockito.junit.MockitoJUnitRunner\nimport java.io.ByteArrayInputStream\n\n@RunWith(MockitoJUnitRunner::class)\nclass BrandAutoOptimizerTest {\n\n    @Mock\n    private lateinit var mockContext: Context\n\n    @Mock\n    private lateinit var mockResources: Resources\n\n    private lateinit var brandAutoOptimizer: BrandAutoOptimizer\n\n    @Before\n    fun setUp() {\n        brandAutoOptimizer = BrandAutoOptimizer()\n        `when`(mockContext.resources).thenReturn(mockResources)\n    }\n\n    @Test\n    fun `getDeviceBrand should return correct brand`() {\n        // Given\n        setManufacturer(\"xiaomi\")\n        // When\n        val brand = brandAutoOptimizer.getDeviceBrand()\n        // Then\n        assertEquals(DeviceBrand.XIAOMI, brand)\n    }\n\n    @Test\n    fun `getOptimizationCommands should return commands for brand`() {\n        // Given\n        val brand = DeviceBrand.XIAOMI\n        val packageName = \"com.test.app\"\n        val jsonContent = JSONObject()\n            .put(\"XIAOMI\", JSONArray(listOf(\"cmd1 \$packageName\", \"cmd2\")))\n            .toString()\n        val inputStream = ByteArrayInputStream(jsonContent.toByteArray())\n\n        `when`(mockResources.openRawResource(R.raw.brand_optimizations)).thenReturn(inputStream)\n\n        // When\n        val commands = brandAutoOptimizer.getOptimizationCommands(brand, packageName, mockContext)\n\n        // Then\n        assertEquals(listOf(\"cmd1 com.test.app\", \"cmd2\"), commands)\n    }\n    \n    @Test\n    fun `getOptimizationCommands should return empty list for unknown brand`() {\n        // Given\n        val brand = DeviceBrand.UNKNOWN\n        val packageName = \"com.test.app\"\n        val jsonContent = JSONObject()\n            .put(\"XIAOMI\", JSONArray(listOf(\"cmd1\")))\n            .toString()\n        val inputStream = ByteArrayInputStream(jsonContent.toByteArray())\n\n        `when`(mockResources.openRawResource(R.raw.brand_optimizations)).thenReturn(inputStream)\n\n        // When\n        val commands = brandAutoOptimizer.getOptimizationCommands(brand, packageName, mockContext)\n\n        // Then\n        assertEquals(emptyList<String>(), commands)\n    }\n\n    private fun setManufacturer(manufacturer: String) {\n        val field = Build::class.java.getDeclaredField(\"MANUFACTURER\")\n        field.isAccessible = true\n        field.set(null, manufacturer)\n    }\n}\n